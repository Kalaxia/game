{% extends 'layouts/game.html.twig' %}

{% block body %}

<div class="component">
	<div class="head"><h1>Messagerie</h1></div>
	<div class="fix-body">
		<div class="body">
			<div class="set-item">
{#				<a class="item" href="'.$appRoot.'message/conversation-new">#}
				<a class="item" href="#">
					<div class="left">
						<span>+</span>
						</div>
					<div class="center">Démarrer une nouvelle conversation</div>
				</a>
			</div>

			<div class="text-white text-center text-4xl p-4"> Work in progress :) </div>

			{# {% for conv in conversations %}


				{% for player in conv.players %}

				{% endfor %}
			{% endfor %}

			for ($i = 0; $i < $conversationManager->size(); ++$i) {
			$conv = $conversationManager->get($i);

			$convAvatar = null;
			$convName = [];
			$convColor = 0;
			$counter = 0;
			$restPlayer = 0;

			$ownLastView = null;

			if (count($conv->players) > 2) {
			$convAvatar = 'multi';
			$convColor = 0;
			} else {
			$convAvatar = $conv->players[0]->playerAvatar;
			$convColor = $conv->players[0]->playerColor;
			}

			foreach ($conv->players as $player) {
				if ($session->get('playerId') !== $player->rPlayer) {
					if ($counter < 5) {
						$convName[] = '<strong>'.$player->playerName.'</strong>';
					} else {
						++$restPlayer;
					}

					if (Conversation::TY_SYSTEM == $conv->type) {
						if (ConversationUser::US_ADMIN == $player->convPlayerStatement) {
							$convAvatar = $player->playerAvatar;
							$convColor = $player->playerColor;
						}
					}

					++$counter;
				} else {
					$ownLastView = $player->dLastView;
				}
			}

			if (0 !== $restPlayer) {
				$convName[count($convName) - 1] .= ' et <strong>'.$restPlayer.'+</strong>';
			}

			<a class="conv-item" href="'.$appRoot.'message/mode-'.$display.'/conversation-'.$conv->id.'">';
				<span class="cover">';
	<img src="'.$mediaPath.'avatar/small/'.$convAvatar.'.png" alt="" class="picture color'.$convColor.'" />';
	<span class="number">'.$conv->messages.'</span>';
	if (strtotime($ownLastView) < strtotime($conv->dLastMessage)) {
		<span class="new-message"><img src="'.$mediaPath.'common/nav-message.png" alt="" /></span>';
	}
	</span>';

				<span class="data">';
	echo Chronos::transform($conv->dLastMessage).'<br />';
	echo empty($conv->title)
				? implode(', ', $convName)
				: '<strong>'.$conv->title.'</strong>';
	</span>';
				</a>';
			}

			if (Conversation::CONVERSATION_BY_PAGE == $conversationManager->size()) {
			<a class="more-item" href="'.$appRoot.'ajax/a-moreconversation/mode-'.$display.'/page-'.(isset($page) ? ($page + 1) : 2).'">';
				Afficher plus de conversations';
				</a>';
			}

			if (!$conversation_listmode) {
			{% if constant('App\\Modules\\Hermes\\Model\\ConversationUser::CS_ARCHIVED') == mode %}
				<a class="common-link" href="{{ url('list_conversations') }}">Retour aux conversations</a>
			{% else %}
				<a class="common-link" href="{{ url('list_conversations', {'mode': constant('App\\Modules\\Hermes\\Model\\ConversationUser::CS_ARCHIVED')}) }}">Voir les conversations archivées</a>
			{% endif %} #}
			</div>
		</div>
	</div>
}}
{% endblock body %}
